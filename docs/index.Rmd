---
title: "Pinniped Case Studies"
subtitle: "Updates, Explorations, Questions, etc."
date: "`r format(Sys.time(), '%B %d, %Y')`"
author: "Liz Allyn"
output: html_document
---
![](img/seal.png){width=100px}![](img/seal.png){width=100px}![](img/seal.png){width=100px}![](img/seal.png){width=100px}![](img/seal.png){width=100px}

```{r, setup, include = FALSE}
knitr::opts_knit$set(root.dir = '~/Github/PinnipedCaseStudies')
```

### Reminders
Repo is [here](https://github.com/lizallyn/Pinniped-Case-Studies)   
Current working model is in "Assemble_the_Legos.R"  
Model Explanation Doc is [here](https://docs.google.com/document/d/1VYwdORJUO0BOJdU_s5iarZ0-YnNVYHJXVU9WCOc4RsY/edit#heading=h.wt3ajsmprmsq) (haphazardly updated right now)

### Currently Working On
Creating a Base Run and making sure it conceptually checks out
Making the results of the base run print to this page for easy comparison
Constructing a diagnostics recipe script
Updating model explanation document

### Some Fun Plots!

```{r, include=FALSE}
getwd()
source("Models/Assemble_The_Legos.R")

```

First, here's a summary of the inputs. Right now it's parameterized for the Locks. 

#### Inputs

Species present here are Sockeye, Chinook, and Coho. Their arrival at the gauntlet each day is forced from count data at the Locks (provided by Muckleshoot).

The number of salmon of each species present at the gauntlet for each day is presented below. Really it's just salmon arriving that are an input not total numbers but I didn't keep tabs on that separately, so here's a close approximation.

```{r, echo = FALSE, fig.height=3}
salmon.arrival.data <- data.frame(cbind(1:days, gauntlet_chinook, gauntlet_sockeye, gauntlet_coho))
colnames(salmon.arrival.data) <- c("Day", "Chinook", "Sockeye", "Coho")
arrival.data <- melt(salmon.arrival.data, "Day", variable.name = "Species", value.name = "Count")
# salmon.colors <- c("dodgerblue", "salmon", "green3")
# salmon.names <- levels(escape.data$Species)
# names(salmon.colors) <- salmon.names
arrival_plot <- ggplot(data = arrival.data, aes(x = Day)) +
  geom_point(data = arrival.data, aes(y = Count, color = Species)) + 
  scale_color_manual(values = salmon.colors) +
  labs(y = "Salmon at the Gauntlet by Species")
arrival_plot
```

The only species with a fishery in this gauntlet is Coho. The fishery occurred from September 10 - November 17 in 2023. This is day 253 - 321. On those days, harvest of coho occurs via fishing effort and harvest of seals occurs via boat-based take.

Here's a quick (not exhaustive) table of parameter values:

```{r, echo = FALSE, message = FALSE, warning = FALSE}
library(knitr)
library(flextable)
library(kableExtra)
parameters <- data.frame(rbind(days, num_seals, num_seals_2_copy, sockeye_escape_rate, chinook_escape_rate, coho_escape_rate, min_fishers, max_fishers, natural_mort))
colnames(parameters) <- c("Value")
kable(parameters) %>% kable_styling(full_width = F)


```

#### Ok, Now the Plots

##### Probability of going to the gauntlet based on foraging experience (P_x), experiences with hunting (P_y), and overall (Prob_G).
Right now these seem to be responding appropriately to the presence of salmon in the system and the presence of hunt effort. We still have decisions to make about how P_x and P_y combine, but this at least works.

```{r, echo = FALSE, fig.width = 10}
plot_Px + plot_Py + plot_probs + plot_layout(guides = "collect")
```

##### Salmon consumption and foraging learning
Seal 10 is prominent because right now all the seals eat the same number of salmon on each day, if they are selected to eat any.
```{r, echo = FALSE}

went_plot <- data.frame(cbind(1:days, colSums(seal_forage_loc)))
colnames(went_plot) <- c("Day", "went")
plot_went <- ggplot(data = went_plot, aes(x = Day, y = went)) +
  geom_point(color = "turquoise") +
  labs(y = "Seals at the Gauntlet")

plot_went/plot_eaten

(plot_C/plot_x/plot_Px/plot_probs) + plot_layout(guides = "collect")
```


### Victories
Created this page! Thanks to Emily for the idea!

